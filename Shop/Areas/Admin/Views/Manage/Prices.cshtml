
@{
    ViewBag.Title = "Цены";
}

<table id="jqGrid"></table>
<div id="jqGridPager"></div>

<script src="~/Scripts/jquery-3.2.1.min.js"></script>
<script src="~/Scripts/i18n/grid.locale-ru.js"></script>
<script src="~/Scripts/jquery.jqGrid.min.js" type="text/javascript"></script>

<link href="~/Content/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
<link href="~/Content/jquery.jqGrid/ui.jqgrid.css" rel="stylesheet" type="text/css" />


<script type="text/javascript">
    $(document).ready(function () {

        $("#jqGrid").jqGrid({
            url: '@Url.Action("GetPrices","Manage")',
            mtype: "GET",
            datatype: "json",
            editurl: 'EditPrice',
            colModel: [
                {
                    label: 'Код',
                    name: 'Id',
                    key: true,
                    width: 150,
                    editable: true,
                    editoptions: { readonly: "readonly" }
                },
                {
                    label: 'Товар', name: 'ProductName', index: 'ProductId', width: 150, editable: true, edittype:"select",
                    editoptions: {
                        dataUrl: '@Url.Action("GetProductsSelectList", "Service", new { Area = ""})',
                        cacheUrlData: true

                    }
                },
                { label: 'Тип цены', name: 'PriceType', width: 150, editable: true, edittype:"select" },
                { label: 'Цена', name: 'Price', width: 150, editable: true }
            ],
            jsonReader: { repeatitems: false },
            loadonce : true,
            onSelectRow: editRow, // the javascript function to call on row click. will ues to to put the row in edit mode
            viewrecords: true,
            width: 750,
            height: 250,
            rowNum: 20,
            pager: "#jqGridPager"

        });

        var lastSelection;

        function editRow(id) {
            if (id && id !== lastSelection) {
                var grid = $("#jqGrid");
                grid.jqGrid('restoreRow',lastSelection);
                grid.jqGrid('editRow',id, {keys:true, focusField: 3});
                lastSelection = id;
            }
        }

    });

</script>